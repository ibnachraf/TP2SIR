/*C5*/SET SCHEMA PUBLIC
create table Chauffage (id bigint generated by default as identity (start with 1), conso float not null, residence_id bigint, primary key (id))
create table ElectronicDevices (id bigint generated by default as identity (start with 1), consommation integer not null, proprio_id bigint, primary key (id))
create table InteligentDevice (InteligentDevicetype varchar(31) not null, id bigint generated by default as identity (start with 1), marque varchar(255), primary key (id))
create table Person (id bigint generated by default as identity (start with 1), mail varchar(255), nom varchar(255), prenom varchar(255), primary key (id))
create table Person_Person (Person_id bigint not null, ami_id bigint not null)
create table Residence (id bigint generated by default as identity (start with 1), nbPieces integer not null, taille integer not null, proprio_id bigint, primary key (id))
alter table Person_Person add constraint UK_ejm7ti25m10o49jp179dtyhfn  unique (ami_id)
alter table Chauffage add constraint FK_2ot81yp1amflqvv5noao5klmx foreign key (residence_id) references Residence
alter table ElectronicDevices add constraint FK_ijpnjawyh701oqivlaotsgvta foreign key (proprio_id) references Person
alter table Person_Person add constraint FK_ejm7ti25m10o49jp179dtyhfn foreign key (ami_id) references Person
alter table Person_Person add constraint FK_inq4xm3i524cmia3rp65fx39w foreign key (Person_id) references Person
alter table Residence add constraint FK_mavb2c4yw4awab0tux0927axb foreign key (proprio_id) references Person
INSERT INTO PERSON VALUES(1,'jj@f.l','martin2','per')
INSERT INTO RESIDENCE VALUES(1,4,3,1)
INSERT INTO CHAUFFAGE VALUES(1,0.0E0,1)
INSERT INTO CHAUFFAGE VALUES(2,0.0E0,1)
INSERT INTO ELECTRONICDEVICES VALUES(1,2,1)
INSERT INTO ELECTRONICDEVICES VALUES(2,3,1)
COMMIT
DISCONNECT
/*C6*/SET SCHEMA PUBLIC
DISCONNECT
/*C7*/SET SCHEMA PUBLIC
DISCONNECT
/*C9*/SET SCHEMA PUBLIC
alter table InteligentDevice add column conso float
alter table InteligentDevice add column residence_id bigint
alter table Person_Person drop constraint UK_ejm7ti25m10o49jp179dtyhfn
alter table Person_Person add constraint UK_ejm7ti25m10o49jp179dtyhfn  unique (ami_id)
alter table InteligentDevice add constraint FK_5gxgkny7kg63r8c6xyct4oeet foreign key (residence_id) references Residence
INSERT INTO PERSON VALUES(2,'jj@f.l','martin2','per')
INSERT INTO RESIDENCE VALUES(2,4,3,2)
INSERT INTO INTELIGENTDEVICE VALUES('Chauffage',1,NULL,0.0E0,2)
INSERT INTO INTELIGENTDEVICE VALUES('Chauffage',2,NULL,0.0E0,2)
INSERT INTO ELECTRONICDEVICES VALUES(3,2,2)
INSERT INTO ELECTRONICDEVICES VALUES(4,3,2)
COMMIT
DISCONNECT
/*C4*/SET SCHEMA PUBLIC
drop table chauffage cascade
drop table electronicdevices cascade
drop table inteligentdevice cascade
drop table person cascade
drop table person_person cascade
drop table residence cascade
/*C10*/SET SCHEMA PUBLIC
create table ElectronicDevices (id bigint generated by default as identity (start with 1), consommation integer not null, proprio_id bigint, primary key (id))
create table InteligentDevice (InteligentDevicetype varchar(31) not null, id bigint generated by default as identity (start with 1), marque varchar(255), conso float, residence_id bigint, primary key (id))
create table Person (id bigint generated by default as identity (start with 1), mail varchar(255), nom varchar(255), prenom varchar(255), primary key (id))
create table Person_Person (Person_id bigint not null, ami_id bigint not null)
create table Residence (id bigint generated by default as identity (start with 1), nbPieces integer not null, taille integer not null, proprio_id bigint, primary key (id))
alter table Person_Person add constraint UK_ejm7ti25m10o49jp179dtyhfn  unique (ami_id)
alter table ElectronicDevices add constraint FK_ijpnjawyh701oqivlaotsgvta foreign key (proprio_id) references Person
alter table InteligentDevice add constraint FK_5gxgkny7kg63r8c6xyct4oeet foreign key (residence_id) references Residence
alter table Person_Person add constraint FK_ejm7ti25m10o49jp179dtyhfn foreign key (ami_id) references Person
alter table Person_Person add constraint FK_inq4xm3i524cmia3rp65fx39w foreign key (Person_id) references Person
alter table Residence add constraint FK_mavb2c4yw4awab0tux0927axb foreign key (proprio_id) references Person
INSERT INTO PERSON VALUES(1,'jj@f.l','martin2','per')
INSERT INTO RESIDENCE VALUES(1,4,3,1)
INSERT INTO INTELIGENTDEVICE VALUES('Chauffage',1,NULL,0.0E0,1)
INSERT INTO INTELIGENTDEVICE VALUES('Chauffage',2,NULL,0.0E0,1)
INSERT INTO ELECTRONICDEVICES VALUES(1,2,1)
INSERT INTO ELECTRONICDEVICES VALUES(2,3,1)
COMMIT
DISCONNECT
/*C11*/SET SCHEMA PUBLIC
alter table InteligentDevice add column consommation integer
alter table InteligentDevice add column proprio_id bigint
alter table Person_Person drop constraint UK_ejm7ti25m10o49jp179dtyhfn
alter table Person_Person add constraint UK_ejm7ti25m10o49jp179dtyhfn  unique (ami_id)
alter table InteligentDevice add constraint FK_hflbloiceakyvndulraw7utwy foreign key (proprio_id) references Person
INSERT INTO PERSON VALUES(2,'jj@f.l','martin2','per')
INSERT INTO RESIDENCE VALUES(2,4,3,2)
INSERT INTO INTELIGENTDEVICE VALUES('Chauffage',3,NULL,0.0E0,2,NULL,NULL)
INSERT INTO INTELIGENTDEVICE VALUES('Chauffage',4,NULL,0.0E0,2,NULL,NULL)
INSERT INTO INTELIGENTDEVICE VALUES('ElectronicDevice',5,NULL,NULL,NULL,2,2)
INSERT INTO INTELIGENTDEVICE VALUES('ElectronicDevice',6,NULL,NULL,NULL,3,2)
COMMIT
DISCONNECT
/*C4*/drop table electronicdevices cascade
drop table person cascade
drop table person_person cascade
drop table inteligentDevice cascade
drop table residence cascade
/*C12*/SET SCHEMA PUBLIC
create table InteligentDevice (InteligentDevicetype varchar(31) not null, id bigint generated by default as identity (start with 1), marque varchar(255), conso float, consommation integer, residence_id bigint, proprio_id bigint, primary key (id))
create table Person (id bigint generated by default as identity (start with 1), mail varchar(255), nom varchar(255), prenom varchar(255), primary key (id))
create table Person_Person (Person_id bigint not null, ami_id bigint not null)
create table Residence (id bigint generated by default as identity (start with 1), nbPieces integer not null, taille integer not null, proprio_id bigint, primary key (id))
alter table Person_Person add constraint UK_ejm7ti25m10o49jp179dtyhfn  unique (ami_id)
alter table InteligentDevice add constraint FK_5gxgkny7kg63r8c6xyct4oeet foreign key (residence_id) references Residence
alter table InteligentDevice add constraint FK_hflbloiceakyvndulraw7utwy foreign key (proprio_id) references Person
alter table Person_Person add constraint FK_ejm7ti25m10o49jp179dtyhfn foreign key (ami_id) references Person
alter table Person_Person add constraint FK_inq4xm3i524cmia3rp65fx39w foreign key (Person_id) references Person
alter table Residence add constraint FK_mavb2c4yw4awab0tux0927axb foreign key (proprio_id) references Person
INSERT INTO PERSON VALUES(1,'jj@f.l','martin2','per')
INSERT INTO RESIDENCE VALUES(1,4,3,1)
INSERT INTO INTELIGENTDEVICE VALUES('Chauffage',1,NULL,0.0E0,NULL,1,NULL)
INSERT INTO INTELIGENTDEVICE VALUES('Chauffage',2,NULL,0.0E0,NULL,1,NULL)
INSERT INTO INTELIGENTDEVICE VALUES('ElectronicDevice',3,NULL,NULL,2,NULL,1)
INSERT INTO INTELIGENTDEVICE VALUES('ElectronicDevice',4,NULL,NULL,3,NULL,1)
COMMIT
DISCONNECT
/*C4*/DISCONNECT
/*C8*/SET SCHEMA PUBLIC
DISCONNECT
/*C13*/SET SCHEMA PUBLIC
alter table Person_Person drop constraint UK_ejm7ti25m10o49jp179dtyhfn
alter table Person_Person add constraint UK_ejm7ti25m10o49jp179dtyhfn  unique (ami_id)
DISCONNECT
/*C15*/SET SCHEMA PUBLIC
alter table Person_Person drop constraint UK_ejm7ti25m10o49jp179dtyhfn
alter table Person_Person add constraint UK_ejm7ti25m10o49jp179dtyhfn  unique (ami_id)
/*C14*/SET SCHEMA PUBLIC
DISCONNECT
/*C16*/SET SCHEMA PUBLIC
DISCONNECT
/*C15*/DISCONNECT
